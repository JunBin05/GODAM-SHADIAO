<!DOCTYPE html>
<html>
<head>
    <title>Phase 1 - CORS & API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #2563eb; }
        .test-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-left: 4px solid #2563eb; }
        button { padding: 10px 20px; margin: 5px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        .result { margin-top: 10px; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 5px; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
        .success { border-left: 4px solid #10b981; background: #f0fdf4; }
        .error { border-left: 4px solid #ef4444; background: #fef2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Phase 1: CORS & Backend Connection Test</h1>
        
        <div class="test-section">
            <h3>Test 1: Backend Health Check</h3>
            <button onclick="testHealth()">Test Backend Health</button>
            <div id="health-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Test 2: Aid Status API</h3>
            <button onclick="testAidStatus()">Get Aid Status (USR001)</button>
            <div id="aid-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Test 3: STR Application Info</h3>
            <button onclick="testSTRInfo('en')">Get STR Info (English)</button>
            <button onclick="testSTRInfo('ms')">Get STR Info (Malay)</button>
            <div id="str-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Test 4: Store Locator</h3>
            <button onclick="testStores()">Find Nearby Stores</button>
            <div id="store-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>‚úÖ Phase 1 Checklist</h3>
            <ul>
                <li id="check-frontend">‚ùì Frontend running at http://localhost:5173</li>
                <li id="check-backend">‚ùì Backend running at http://localhost:8000</li>
                <li id="check-cors">‚ùì CORS configured correctly</li>
                <li id="check-api">‚ùì API endpoints accessible</li>
            </ul>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';

        // Update checklist
        document.getElementById('check-frontend').innerHTML = '‚úÖ Frontend running at http://localhost:5173';
        
        async function testHealth() {
            const result = document.getElementById('health-result');
            try {
                const response = await fetch('http://localhost:8000/');
                const data = await response.json();
                result.className = 'result success';
                result.textContent = JSON.stringify(data, null, 2);
                document.getElementById('check-backend').innerHTML = '‚úÖ Backend running at http://localhost:8000';
                document.getElementById('check-cors').innerHTML = '‚úÖ CORS configured correctly';
            } catch (error) {
                result.className = 'result error';
                result.textContent = 'ERROR: ' + error.message;
                document.getElementById('check-backend').innerHTML = '‚ùå Backend connection failed';
            }
        }

        async function testAidStatus() {
            const result = document.getElementById('aid-result');
            try {
                const response = await fetch(`${API_BASE}/aid/status/USR001`);
                const data = await response.json();
                result.className = 'result success';
                result.textContent = JSON.stringify(data, null, 2);
                document.getElementById('check-api').innerHTML = '‚úÖ API endpoints accessible';
            } catch (error) {
                result.className = 'result error';
                result.textContent = 'ERROR: ' + error.message;
            }
        }

        async function testSTRInfo(lang) {
            const result = document.getElementById('str-result');
            try {
                const response = await fetch(`${API_BASE}/str-application/application-info?lang=${lang}`);
                const data = await response.json();
                result.className = 'result success';
                result.textContent = `Language: ${lang.toUpperCase()}\n\n` + JSON.stringify(data, null, 2);
            } catch (error) {
                result.className = 'result error';
                result.textContent = 'ERROR: ' + error.message;
            }
        }

        async function testStores() {
            const result = document.getElementById('store-result');
            try {
                // Kuala Lumpur coordinates
                const response = await fetch(`${API_BASE}/stores/nearby?lat=3.139&lng=101.6869&radius=5&lang=en`);
                const data = await response.json();
                result.className = 'result success';
                result.textContent = `Found ${data.stores?.length || 0} stores\n\n` + JSON.stringify(data, null, 2).substring(0, 1000) + '...';
            } catch (error) {
                result.className = 'result error';
                result.textContent = 'ERROR: ' + error.message;
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testHealth, 500);
        });
    </script>
</body>
</html>
